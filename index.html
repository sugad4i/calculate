<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>エントランス滞在率計算</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: sans-serif; padding: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #999; padding: 8px; text-align: center; }
    input { width: 60px; text-align: center; font-size: 16px; }
    .fixed { background-color: #cce5ff; }
  </style>
</head>
<body>

<h2>エントランス滞在率計算</h2>

<table>
  <thead>
    <tr>
      <th>時間帯</th>
      <th>IN</th>
      <th>OUT</th>
      <th>IN合計</th>
      <th>OUT合計</th>
      <th>滞在数</th>
      <th>滞在率</th>
    </tr>
  </thead>
  <tbody id="table-body">
  </tbody>
</table>

<script>
// 時間帯リスト
const timeSlots = [
  "22:00-23:00", "23:00-24:00", "24:00-1:00",
  "1:00-2:00", "2:00-3:00", "3:00-4:00", "4:00-4:30"
];

// データ保存用
let data = JSON.parse(localStorage.getItem('entranceData')) || timeSlots.map(() => ({in: '', out: ''}));

const tbody = document.getElementById('table-body');

// テーブルを作る
function renderTable() {
  tbody.innerHTML = '';
  let inTotal = 0;
  let outTotal = 0;

  timeSlots.forEach((slot, i) => {
    const row = document.createElement('tr');

    const tdTime = document.createElement('td');
    tdTime.textContent = slot;
    row.appendChild(tdTime);

    const tdIn = document.createElement('td');
    const inputIn = document.createElement('input');
    inputIn.type = 'number';
    inputIn.value = data[i].in;
    inputIn.oninput = () => {
      data[i].in = Number(inputIn.value);
      saveData();
      renderTable();
    };
    tdIn.appendChild(inputIn);
    row.appendChild(tdIn);

    const tdOut = document.createElement('td');
    const inputOut = document.createElement('input');
    inputOut.type = 'number';
    inputOut.value = data[i].out;
    inputOut.oninput = () => {
      data[i].out = Number(inputOut.value);
      saveData();
      renderTable();
    };
    tdOut.appendChild(inputOut);
    row.appendChild(tdOut);

    inTotal += Number(data[i].in) || 0;
    outTotal += Number(data[i].out) || 0;
    const stay = inTotal - outTotal;
    const stayRate = inTotal > 0 ? Math.round((stay / inTotal) * 100) : 0;

    const tdInSum = document.createElement('td');
    tdInSum.textContent = inTotal;
    tdInSum.classList.add('fixed');
    row.appendChild(tdInSum);

    const tdOutSum = document.createElement('td');
    tdOutSum.textContent = outTotal;
    tdOutSum.classList.add('fixed');
    row.appendChild(tdOutSum);

    const tdStay = document.createElement('td');
    tdStay.textContent = stay;
    tdStay.classList.add('fixed');
    row.appendChild(tdStay);

    const tdStayRate = document.createElement('td');
    tdStayRate.textContent = stayRate + '%';
    tdStayRate.classList.add('fixed');
    row.appendChild(tdStayRate);

    tbody.appendChild(row);
  });
}

// データ保存
function saveData() {
  localStorage.setItem('entranceData', JSON.stringify(data));
}

// 最初に表示
renderTable();
</script>

</body>
</html>
