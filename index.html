<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>エントランス集計ツール ver1.1.2（2024/04/27更新）</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: sans-serif; margin: 0; }
    header {
      background: #eee;
      padding: 10px 20px;
      font-size: 20px;
      font-weight: bold;
    }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #999; padding: 8px; text-align: center; }
    input { width: 60px; text-align: center; font-size: 16px; }
    .fixed { background-color: #cce5ff; }
    button { font-size: 14px; padding: 4px 8px; margin: 2px; }
    #output-area { margin-top: 30px; padding: 0 20px; }
    #output { 
      padding: 10px; 
      border: 1px solid #999; 
      min-height: 60px; 
      white-space: pre-wrap; 
      background: #f9f9f9; 
      font-family: monospace; 
      font-size: 16px;
    }
    main { padding: 20px; }
  </style>
</head>
<body>

<header>エントランス集計ツール ver1.1.2（2024/04/27更新）</header>

<main>
<table>
  <thead>
    <tr>
      <th>時間帯</th>
      <th>IN</th>
      <th>OUT</th>
      <th>IN合計</th>
      <th>OUT合計</th>
      <th>滞在数</th>
      <th>滞在率</th>
      <th>出力</th>
    </tr>
  </thead>
  <tbody id="table-body">
  </tbody>
</table>

<div id="output-area">
  <button onclick="copyOutput()">コピー</button>
  <div id="output"></div>
</div>
</main>

<script>
// 時間帯リスト
const timeSlots = [
  "22:00-23:00", "23:00-24:00", "24:00-1:00",
  "1:00-2:00", "2:00-3:00", "3:00-4:00", "4:00-4:30"
];

// データ保存用
let data = JSON.parse(localStorage.getItem('entranceData')) || timeSlots.map(() => ({in: '', out: ''}));

const tbody = document.getElementById('table-body');
const outputDiv = document.getElementById('output');

// テーブルを作る
function renderTable() {
  tbody.innerHTML = '';
  let inTotal = 0;
  let outTotal = 0;

  timeSlots.forEach((slot, i) => {
    const row = document.createElement('tr');

    const tdTime = document.createElement('td');
    tdTime.textContent = slot;
    row.appendChild(tdTime);

    const tdIn = document.createElement('td');
    const inputIn = document.createElement('input');
    inputIn.type = 'number';
    inputIn.value = data[i].in;
    inputIn.onchange = () => {
      data[i].in = Number(inputIn.value);
      saveData();
      renderTable();
    };
    tdIn.appendChild(inputIn);
    row.appendChild(tdIn);

    const tdOut = document.createElement('td');
    const inputOut = document.createElement('input');
    inputOut.type = 'number';
    inputOut.value = data[i].out;
    inputOut.onchange = () => {
      data[i].out = Number(inputOut.value);
      saveData();
      renderTable();
    };
    tdOut.appendChild(inputOut);
    row.appendChild(tdOut);

    inTotal += Number(data[i].in) || 0;
    outTotal += Number(data[i].out) || 0;
    const stay = inTotal - outTotal;
    const stayRate = inTotal > 0 ? Math.round((stay / inTotal) * 100) : 0;

    const tdInSum = document.createElement('td');
    tdInSum.textContent = inTotal;
    tdInSum.classList.add('fixed');
    row.appendChild(tdInSum);

    const tdOutSum = document.createElement('td');
    tdOutSum.textContent = outTotal;
    tdOutSum.classList.add('fixed');
    row.appendChild(tdOutSum);

    const tdStay = document.createElement('td');
    tdStay.textContent = stay;
    tdStay.classList.add('fixed');
    row.appendChild(tdStay);

    const tdStayRate = document.createElement('td');
    tdStayRate.textContent = stayRate + '%';
    tdStayRate.classList.add('fixed');
    row.appendChild(tdStayRate);

    // 出力ボタン
    const tdButton = document.createElement('td');
    const button = document.createElement('button');
    button.textContent = '出力';
    button.onclick = () => {
      const inSingle = String(data[i].in || 0).padStart(2, ' ');
      const outSingle = String(data[i].out || 0).padStart(2, ' ');
      const inTotalStr = String(inTotal).padStart(3, ' ');
      const outTotalStr = String(outTotal).padStart(3, ' ');

      outputDiv.textContent =
        `${slot}\n` +
        `in  ${inSingle}人 計${inTotalStr}人\n` +
        `out ${outSingle}人 計${outTotalStr}人\n` +
        `滞在率${stayRate}%`;
    };
    tdButton.appendChild(button);
    row.appendChild(tdButton);

    tbody.appendChild(row);
  });
}

// 出力テキストをコピーする
function copyOutput() {
  const text = outputDiv.textContent;
  if (!text) return;
  navigator.clipboard.writeText(text)
    .then(() => alert('コピーしました！'))
    .catch(err => alert('コピー失敗：' + err));
}

// データ保存
function saveData() {
  localStorage.setItem('entranceData', JSON.stringify(data));
}

// 最初に表示
renderTable();
</script>

</body>
</html>